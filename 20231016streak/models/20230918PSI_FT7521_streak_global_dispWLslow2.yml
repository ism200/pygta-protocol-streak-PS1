default_megacomplex: decay
dataset_groups:
  streak:
    residual_function: non_negative_least_squares
    link_clp: True

dataset:
  FT7521WLtr1:
    group: streak
    megacomplex: [FT7521complexWL,freeChla]
    megacomplex_scale: [FT7521scalem.1,FT7521scalem.WLtr1a]
    initial_concentration: FT7521inputWLtr1
    irf: FT7521irfWLtr1
    scale: FT7521scale.WLtr1
  FT7521WLtr2:
    group: streak
    megacomplex: [FT7521complexWL,freeChla]
    megacomplex_scale: [FT7521scalem.1,FT7521scalem.WLtr2a]
    initial_concentration: FT7521inputWLtr2
    irf: FT7521irfWLtr2
    scale: FT7521scale.WLtr2
  FT7521WLtr4:
    group: streak
    megacomplex: [FT7521complexWL,freeChla]
    megacomplex_scale: [FT7521scalem.1,FT7521scalem.WLtr4a]
    initial_concentration: FT7521inputWLtr4
    irf: FT7521irfWLtr4
    scale: FT7521scale.WLtr4

megacomplex:
  freeChla:
    k_matrix: [FT7521kmChla]
  FT7521complexWL:
    k_matrix: [FT7521WL]

# note that earlier definition will override later definition
k_matrix:
  FT7521WL:
    matrix:
      (br2, br1): brates.k21
      (br3, br2): brates.k32
      (br3, br3): brates.k33
      (br1, slowChla): FT7521rates.slow
  FT7521kmChla:
    matrix:
      (freeChla, freeChla): FT7521rates.kF

initial_concentration:
  FT7521inputWLtr1:
    compartments: [br1,br2,br3,freeChla,slowChla]
    parameters: [input.1, input.0, input.0, input.1,input.slowtr1]
    exclude_from_normalize: [freeChla]
  FT7521inputWLtr2:
    compartments: [br1,br2,br3,freeChla,slowChla]
    parameters: [input.1, input.0, input.0, input.1,input.slowtr2]
    exclude_from_normalize: [freeChla]
  FT7521inputWLtr4:
    compartments: [br1,br2,br3,freeChla,slowChla]
    parameters: [input.1, input.0, input.0, input.1,input.slowtr4]
    exclude_from_normalize: [freeChla]

clp_penalties:
  - type: equal_area
    source: freeChla
    source_intervals: [[0, 1000]]
    target: br1
    target_intervals: [[0, 1000]]
    parameter: area.1
    weight: 0.62e-2
  - type: equal_area
    source: slowChla
    source_intervals: [[0, 1000]]
    target: br1
    target_intervals: [[0, 1000]]
    parameter: area.1
    weight: 0.62e-2

# it is implicitly normalized, i.e. divided by sum of irfscale parameters
irf:
  FT7521irfWLtr1:
    type: spectral-multi-gaussian
    center: [FT7521irfWLtr1.center]
    width: [FT7521irfWLtr1.width1,FT7521irfWLtr1.width2]
    scale: [FT7521irfWLtr1.scale1,FT7521irfWLtr1.scale2]
    backsweep: True
    backsweep_period: irf.common_backsweep
    dispersion_center: irf.dispcenter
    center_dispersion_coefficients: [irf.disp1,irf.disp2]
  FT7521irfWLtr2:
    type: spectral-multi-gaussian
    center: [FT7521irfWLtr2.center]
    width: [FT7521irfWLtr2.width1,FT7521irfWLtr2.width2]
    scale: [FT7521irfWLtr2.scale1,FT7521irfWLtr2.scale2]
    backsweep: True
    backsweep_period: irf.common_backsweep
    dispersion_center: irf.dispcenter
    center_dispersion_coefficients: [irf.disp1,irf.disp2]
  FT7521irfWLtr4:
    type: spectral-multi-gaussian
    center: [FT7521irfWLtr4.center]
    width: [FT7521irfWLtr4.width1,FT7521irfWLtr4.width2]
    scale: [FT7521irfWLtr4.scale1,FT7521irfWLtr4.scale2]
    backsweep: True
    backsweep_period: irf.common_backsweep
    dispersion_center: irf.dispcenter
    center_dispersion_coefficients: [irf.disp1,irf.disp2]

# weights:
#   - datasets: [FT7521WLtr1,FT7521WLtr2]
#     global_interval: [100, 1000]
#     value: 0.5
#   - datasets: [FT7521WLtr4]
#     global_interval: [100, 1000]
#     value: 0.2