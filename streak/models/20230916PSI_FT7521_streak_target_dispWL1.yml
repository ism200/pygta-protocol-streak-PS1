default_megacomplex: decay
dataset_groups:
  streak:
    residual_function: non_negative_least_squares
    link_clp: True
  default:
    residual_function: variable_projection
    link_clp: True

dataset:
  FT7521WLtr1:
    group: streak
    megacomplex: [FT7521complexWL,FT7521freeChla,FT7521freeChla2]
    megacomplex_scale: [FT7521scalem.1,FT7521scalem.WLtr1a,FT7521scalem.WLtr1a]
    initial_concentration: FT7521inputWL
    irf: FT7521irfWLtr1
    scale: FT7521scale.WLtr1
  FT7521WLtr2:
    group: streak
    megacomplex: [FT7521complexWL,FT7521freeChla,FT7521freeChla2]
    megacomplex_scale: [FT7521scalem.1,FT7521scalem.WLtr2a,FT7521scalem.WLtr2a2]
    initial_concentration: FT7521inputWL
    irf: FT7521irfWLtr2
    scale: FT7521scale.WLtr2
  FT7521WLtr4:
    group: streak
    megacomplex: [FT7521complexWL,FT7521freeChla,FT7521freeChla2]
    megacomplex_scale: [FT7521scalem.1,FT7521scalem.WLtr4a,FT7521scalem.WLtr4a2]
    initial_concentration: FT7521inputWL
    irf: FT7521irfWLtr4
    scale: FT7521scale.WLtr4
  WLRCSAS:
    group: streak
    megacomplex:
    - smc4
    scale: scale.WLRCSAS



megacomplex:
  FT7521freeChla:
    k_matrix: [FT7521kmChla]
  FT7521freeChla2:
    k_matrix: [FT7521kmChla2]
  FT7521complexWL:
    # k_matrix: [FT7521skmBulkWL,FT7521skmWLRC,FT7521skmWLRCtrap]
    k_matrix: [FT7521skmBulkWL]
  smc4:
    dimension: time
    target: FT7521WLRC
    type: clp-guide
# note that earlier definition will override later definition
# xrates correction for different numbers of Bulk Chl a pigments in WL vs FRL (78 vs 70)
k_matrix:
  FT7521skmBulkWL:
    matrix:
      (FT7521Bulk, FT7521Red1): FT7521rates.ToBulkFromRed1
      (FT7521Red1, FT7521Bulk): FT7521rates.ToRed1FromBulk
      (FT7521Bulk, FT7521Red2): FT7521rates.ToBulkFromRed2
      (FT7521Red2, FT7521Bulk): FT7521rates.ToRed2FromBulk
      (FT7521Red1, FT7521Red1): FT7521rates.kF
      (FT7521Red2, FT7521Red2): FT7521rates.kF
  # FT7521skmWLRC:
  #   matrix:
      (FT7521WLRC, FT7521WLRP1): FT7521rates.ToWLRCFromWLRP1
      (FT7521WLRP1, FT7521WLRC): FT7521rates.ToWLRP1FromWLRC
      (FT7521Bulk, FT7521WLRC): FT7521rates.ToBulkFromWLRC
      (FT7521WLRC, FT7521Bulk): FT7521rates.ToWLRCFromBulk
  # FT7521skmWLRCtrap:
  #   matrix:
      (FT7521WLRP1, FT7521WLRP1): FT7521rates.WLRP1
      (FT7521Bulk, FT7521Bulk): FT7521rates.kF
  FT7521kmChla:
    matrix:
      (FT7521freeChla, FT7521freeChla): FT7521rates.kF
  FT7521kmChla2:
    matrix:
      (FT7521freeChla2, FT7521freeChla2): FT7521rates.kFa2

initial_concentration:
  FT7521inputWL:
    compartments: [FT7521Bulk,FT7521Red1,FT7521Red2,FT7521WLRC,FT7521freeChla,FT7521freeChla2,FT7521WLRP1]
    parameters: [input.Bulk,input.Red1, input.Red2, input.RC,input.1,input.1,input.0]
    exclude_from_normalize: [FT7521freeChla,FT7521freeChla2]

clp_penalties:
  - type: equal_area
    source: FT7521Red2
    source_intervals: [[0, 1000]]
    target: FT7521freeChla
    target_intervals: [[0, 1000]]
    parameter: area.Bulk
    weight: 0.62e-2
  - type: equal_area
    source: FT7521Red2
    source_intervals: [[0, 1000]]
    target: FT7521Bulk
    target_intervals: [[0, 1000]]
    parameter: area.Bulk
    weight: 0.62e-2
  - type: equal_area
    source: FT7521Red2
    source_intervals: [[0, 1000]]
    target: FT7521Red1
    target_intervals: [[0, 1000]]
    parameter: area.1
    weight: 0.62e-2
  - type: equal_area
    source: FT7521Red2
    source_intervals: [[0, 1000]]
    target: FT7521WLRC
    target_intervals: [[0, 1000]]
    parameter: area.1
    weight: 0.62e-2

clp_relations:
  - source: FT7521freeChla
    target: FT7521freeChla2
    parameter: rel.r1
#     interval: [[0, 1000]]
#   - source: sRed1
#     target: FT7521Red1
#     parameter: rel.r1
#     interval: [[0, 1000]]
#   - source: sRed2
#     target: FT7521Red2
#     parameter: rel.r1
#     interval: [[0, 1000]]

clp_constraints:
  - type: zero
    target: FT7521Red2
    interval:
      - [100, 683]
  - type: zero
    target: FT7521WLRP1
    interval:
      - [100, 1000]
      #

# it is implicitly normalized, i.e. divided by sum of irfscale parameters
irf:
  FT7521irfWLtr1:
    type: spectral-multi-gaussian
    center: [FT7521irfWLtr1.center]
    width: [FT7521irfWLtr1.width1,FT7521irfWLtr1.width2]
    scale: [FT7521irfWLtr1.scale1,FT7521irfWLtr1.scale2]
    backsweep: True
    backsweep_period: irf.common_backsweep
    dispersion_center: irf.dispcenter
    center_dispersion_coefficients: [irf.FT7521disp1,irf.FT7521disp2]
  FT7521irfWLtr2:
    type: spectral-multi-gaussian
    center: [FT7521irfWLtr2.center]
    width: [FT7521irfWLtr2.width1,FT7521irfWLtr2.width2]
    scale: [FT7521irfWLtr2.scale1,FT7521irfWLtr2.scale2]
    backsweep: True
    backsweep_period: irf.common_backsweep
    dispersion_center: irf.dispcenter
    center_dispersion_coefficients: [irf.FT7521disp1,irf.FT7521disp2]
  FT7521irfWLtr4:
    type: spectral-multi-gaussian
    center: [FT7521irfWLtr4.center]
    width: [FT7521irfWLtr4.width1,FT7521irfWLtr4.width2]
    scale: [FT7521irfWLtr4.scale1,FT7521irfWLtr4.scale2]
    backsweep: True
    backsweep_period: irf.common_backsweep
    dispersion_center: irf.dispcenter
    center_dispersion_coefficients: [irf.FT7521disp1,irf.FT7521disp2]

weights:
  - datasets: [WLRCSAS]
    global_interval: [100, 1000]
    value: 0.1